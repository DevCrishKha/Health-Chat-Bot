<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Health Chat Bot</title>
<style>
    /* --- WhatsApp Color Palette --- */
    :root {
        --wa-dark-green: #075E54;    /* Header color */
        --wa-light-green: #25D366;   /* Button accent/Sent checkmark color */
        --wa-bg: #ECE5DD;            /* General background (subtle wallpaper texture) */
        --wa-user-bubble: #DCF8C6;   /* User (sent) message bubble */
        --wa-bot-bubble: #FFFFFF;    /* Bot (received) message bubble */
        --wa-input-bg: #F0F0F0;      /* Input bar background */
        --text: #111827;
        --muted: #6b7280;
        font-family: Roboto, Arial, sans-serif; /* WhatsApp often uses variations of Roboto */
    }

    /* --- Global Styles & Setup --- */
    body {
        background: var(--wa-bg);
        margin: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        /* Using 100vh for full-screen feel */
        height: 100vh;
    }

    .chat-container {
        width: 100%;
        max-width: 600px; /* Slimmer for a phone look */
        height: 95vh;
        background: var(--wa-bot-bubble);
        border-radius: 0; /* No rounding for full-screen feel */
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }

    /* --- Header Styling --- */
    header {
        padding: 16px;
        background: var(--wa-dark-green);
        color: white;
        text-align: left; /* Aligned left, like a chat name */
        font-weight: 500;
        font-size: 18px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    /* --- Chat Box (Message Area) --- */
    .chat-box {
        flex: 1;
        padding: 6px 8px; /* Slightly less padding */
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 4px; /* Tighter gap between messages */
        /* WhatsApp-like wallpaper background */
        background-color: var(--wa-bg);
        background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 500"><defs><pattern id="wa-pattern" x="0" y="0" width="100" height="100" patternUnits="userSpaceOnUse"><path d="M 50 0 L 50 100 M 0 50 L 100 50" stroke="%23d0d0c0" stroke-width="0.5"/></pattern></defs><rect width="100%" height="100%" fill="url(%23wa-pattern)" opacity="0.1"/></svg>');
    }

    /* --- Message Bubbles --- */
    .message {
        position: relative;
        max-width: 80%;
        padding: 8px 10px;
        line-height: 1.3;
        font-size: 15px;
        white-space: pre-wrap;
        /* WhatsApp-style rounded corners: slightly sharper edges on the inside corner */
        box-shadow: 0 1px 0.5px rgba(0, 0, 0, 0.1);
    }

    /* User (Sent) Message Bubble */
    .message.user {
        align-self: flex-end;
        background: var(--wa-user-bubble); /* Light green */
        color: #000;
        /* Sharp corner top-right, smooth everywhere else */
        border-radius: 10px 0px 10px 10px;
    }

    /* Bot (Received) Message Bubble */
    .message.bot {
        align-self: flex-start;
        background: var(--wa-bot-bubble); /* White/Light gray */
        color: #000;
        /* Sharp corner top-left, smooth everywhere else */
        border-radius: 0px 10px 10px 10px;
    }

    /* --- Input Form (Footer) --- */
    form {
        display: flex;
        padding: 10px;
        background: var(--wa-input-bg); /* Light gray input area */
    }

    textarea {
        flex: 1;
        resize: none;
        border: none;
        /* Pill-shaped textarea */
        border-radius: 20px; 
        padding: 10px 14px;
        font-size: 15px;
        background: white;
        box-shadow: inset 0 0 3px rgba(0, 0, 0, 0.05);
        align-self: center;
        max-height: 48px; /* Limit height for one or two lines */
    }

    button {
        background: var(--wa-light-green); /* Bright green button */
        color: white;
        border: none;
        border-radius: 50%; /* Circular button */
        width: 44px;
        height: 44px;
        padding: 0;
        margin-left: 8px;
        cursor: pointer;
        font-size: 18px; /* You might want to use an emoji or icon here */
        display: flex;
        justify-content: center;
        align-items: center;
        flex-shrink: 0;
    }

    button:hover {
        background: #128C7E; /* Slightly darker green on hover */
    }
    
    .disclaimer {
        font-size: 12px;
        color: var(--muted);
        text-align: center;
        padding: 5px 8px;
        border-top: 1px solid rgba(0, 0, 0, 0.05);
        background: white;
    }
    
</style>
</head>
<body>
  <div class="chat-container">
    <header>Health Chat Bot</header>

    <div class="chat-box" id="chat-history-box">
    {% for msg in messages[1:] %}
      <div class="message {{ msg['role'] }}">
        {# This is the correct way to access the text from your Python structure #}
        {{ msg['parts'][0]['text'] | safe}}
      </div>
    {% endfor %}
</div>

    <form action="{{ url_for('chat') }}" method="post">
      <textarea name="user_input" rows="2" placeholder="Type your message..." required></textarea>
      <button type="submit">Send</button>
    </form>

    <div class="disclaimer">
      ⚠️ This chatbot provides informational support only and is not a substitute for professional medical advice.
    </div>
  </div>
</body>

<script>
    function scrollToBottom() {
        // 1. Get the chat box element by its ID
        const chatBox = document.getElementById('chat-history-box');
        
        // 2. Check if the element exists
        if (chatBox) {
            // 3. Scroll the element to its maximum scroll height
            //    This effectively scrolls to the very bottom.
            chatBox.scrollTop = chatBox.scrollHeight;
        }
    }

    // Run the function as soon as the entire page finishes loading
    window.onload = scrollToBottom;
</script>

</html>
